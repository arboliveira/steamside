<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
xmlns:wicket="http://wicket.apache.org/dtds.data/wicket-xhtml1.4-strict.dtd" 
xml:lang="en" lang="en">
<head>
<!-- ----------------------------------------------------------------------- -->

		<meta charset="utf-8" />
		<title>SteamSide</title>
		
		<link href="http://fonts.googleapis.com/css?family=Ubuntu:regular, bold" rel="stylesheet" type='text/css' />
		<link href="http://fonts.googleapis.com/css?family=Arvo:regular, bold" rel="stylesheet" type="text/css" />
		
		 <style type="text/css">
		 #content h1 { font-family: Ubuntu; font-size: 36px; font-weight: bold; margin: 28px 0 16px 0; }
		 #content p { font-family: Arvo; font-size: 20px; }
		 </style>
		
		<!-- 
		<link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:regular,bold' rel='stylesheet' type='text/css' />
		 -->
		<link rel="stylesheet" href="style.css" type="text/css" media="screen" title="Stylesheet" />


<wicket:link>
    <script src="jquery-1.7.2.js"></script>
    <script src="underscore.js"></script>
    <script src="backbone.js"></script>
   </wicket:link>
   
   <!-- 
    <link href="http://fonts.googleapis.com/css?family=Abel" rel="stylesheet" type="text/css">
    -->




<!-- ----------------------------------------------------------------------- -->

<script>
		
var Game = Backbone.Model.extend();

var RecentlyPlayed = Backbone.Collection.extend({
    model: Game,
    url: function() {
    	return 'search-results.json'; 
    }
});

var GameCollection = Backbone.Collection.extend({
    model: Game,
    value: null,
    url: function() {
    	return 'search-results.json'; 
    	//return "search?query=" + this.value;
    }
});

var SearchTextView = Backbone.View.extend({
    events: {
        'submit form': 'submitSearch'
    },

    initialize: function() {
        
    },

    submitSearch: function(e) {
        e.preventDefault();

		var c = this.collection;
		c.value = this.$('#input-id-text-search').val();
		c.fetch({
			success: function() { if (false) console.log(c.models); },
			error: function() { console.log(arguments); }
		});
    }
});

var GameCollectionView = Backbone.View.extend({
	resultsEl: null,
	gametileEl: null,

    initialize: function() {
    	this.gametileEl = this.options.gametileEl;
    	this.resultsEl = this.$('.game-tiles');
        this.collection.on('reset', this.displaySearchResults, this);
    },

    displaySearchResults: function() {
    	var vtile = this.gametileEl;
    	var vresultsEl = this.resultsEl;
    	vresultsEl.empty();
        this.collection.each( function(oneResult) {
	        var clonedtile = vtile.clone();
	        
	        clonedtile.find('.game-name').text(oneResult.get('name'));
	        
	        var appid = oneResult.get('appid');
	        var img = 
	        	'http://cdn.steampowered.com/v/gfx/apps/' 
	        	+ appid + '/header_292x136.jpg';
	        clonedtile.find('.game-img').attr('src', img);
	        
	        var link = clonedtile.find('.game-link');
	        link.attr('href', oneResult.get('link'));
	        link.click(function(e) {
	        	var jLink = $( this );
	        	var aUrl = jLink.attr( "href" );
	        	alert(aUrl);
				$.ajax(
					{
						url: aUrl
					}
				);
				e.preventDefault();
    		});
    		
	        vresultsEl.append(clonedtile);
	        clonedtile.fadeIn();
        });
    }
});

$(document).ready(function() {
	var gametile = $('#game-tile');
	var recentlyplayed = new RecentlyPlayed();
    var searchresults = new GameCollection();
    new GameCollectionView({ 
    	el: $('#recently-played'), 
    	collection: recentlyplayed,
    	gametileEl: gametile    	 
    });
    new SearchTextView({ 
    	el: $('#div-id-search-text'), 
    	collection: searchresults
    });
    new GameCollectionView({ 
    	el: $('#div-id-search-results'), 
    	collection: searchresults,
    	gametileEl: gametile    	 
    });
    recentlyplayed.fetch();
});			

</script>


<!-- ----------------------------------------------------------------------- -->
</head>
<body>
<!-- ----------------------------------------------------------------------- -->

<div id="game-tile" style="float:left; display:none;">
	<a class="game-link" href="">
	<img class="game-img" src="game.jpg" />
	<br/>
	<big><strong>
	<span class="game-name">Search result</span>
	</strong></big>
	</a>
</div>

		
		
<div id="content">

	<h1>Continue</h1>	

	<p class=handwritten>Played from SteamSide</p>
		
	<div id="continue-games">	
		<big><strong>
		<a wicket:id="link"><span wicket:id="caption">Skyrim</span></a>
		</strong></big>
	</div>

    <div id="recently-played" style="float:right;">
      	<div class="game-tiles">
		</div>
    </div>

		
	<h1>Games</h1>
		
	<p><span wicket:id="number-of-games">101</span> games</p>
		
	<h1>Search</h1>
		
	<div id="div-id-search-text">
		<h2>Search...</h2>
		<form action="">
			<input type="text" name="text-search" id="input-id-text-search"/>
        	<br />
        	<input type="submit" value="Post"/>
      	</form>
    </div>

    <div id="div-id-search-results">
    	<h2>Search results</h2>
      	<div class="game-tiles">
		</div>
    </div>
		
</div>
		
<hr/>		
		
		
<div id="bd">
	<p>
		Please mention the correct Wicket version: <wicket:container wicket:id="version">1.5-SNAPSHOT</wicket:container>.
	</p>
</div>

<div id="ft">
</div>
		
		
<!-- ----------------------------------------------------------------------- -->
</body>
</html>